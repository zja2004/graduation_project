# ✅ 当前系统配置

## 🎯 核心配置

### Genos DCS API

| 配置项 | 值 | 说明 |
|--------|-----|------|
| **模型** | **Genos-10B** ⭐ | 百亿参数级基因组大模型 |
| **API Token** | `sk-NSsjvPwgyb0K...` | 已配置 |
| **端点** | `https://cloud.stomics.tech` | 华大云官方 API |
| **池化方法** | `mean` | 平均池化 |
| **超时** | 60s | 请求超时时间 |
| **模拟模式** | `false` | 使用真实 API |

### 模型对比

| 特性 | Genos-1.2B | **Genos-10B (当前)** |
|------|-----------|---------------------|
| 参数量 | 12亿 | **100亿** ⭐ |
| Embedding 维度 | 4096 | **更高** |
| 推理速度 | 快 (~0.8s) | 中等 (~1.5s) |
| 预测精度 | 良好 | **优秀** ⭐ |
| 适用场景 | 快速筛查 | **精准诊断** |

**当前选择**: Genos-10B - 适合需要高精度的临床变异解读场景

---

## 📊 性能预估

### API 调用时间（Genos-10B）

| 序列长度 | 单次调用时间 | 备注 |
|---------|------------|------|
| 500bp | ~1.0s | 短序列 |
| 2000bp | ~1.5s | 标准窗口（本项目默认） |
| 10000bp | ~4.0s | 长序列 |

### 完整分析流程预估

对于 **10 个变异**（测试 VCF）:

| 步骤 | API 调用次数 | 预计时间 |
|------|------------|---------|
| Embedding 生成 | 20 次 (ref + alt) | ~30-40s |
| 其他步骤 | 0 | ~5s |
| **总计** | **~20 次** | **~35-45s** |

对于 **100 个变异**（真实场景）:

| 步骤 | API 调用次数 | 预计时间 |
|------|------------|---------|
| Embedding 生成 | 200 次 | ~5-6 分钟 |
| 其他步骤 | 0 | ~30s |
| **总计** | **~200 次** | **~6-7 分钟** |

---

## 🔧 配置文件位置

### 主配置文件

[configs/run.yaml](configs/run.yaml) - 第 12 行:
```yaml
model_name: "Genos-10B"  # ← 当前配置
```

### Token 配置脚本

Token 已配置在以下文件中：
- [快速测试.bat](快速测试.bat)
- [设置API_Token.bat](设置API_Token.bat)
- [永久设置API_Token.ps1](永久设置API_Token.ps1)

---

## 🎛️ 自定义配置

### 切换回 1.2B 模型（更快）

编辑 [configs/run.yaml](configs/run.yaml):
```yaml
genos:
  model_name: "Genos-1.2B"  # 改为 1.2B
```

**适用场景**: 需要快速筛查大量变异

### 调整超时时间

如果网络较慢，可增加超时：
```yaml
genos:
  timeout: 120  # 增加到 120 秒
```

### 启用模拟模式（离线测试）

```yaml
genos:
  mock_mode: true  # 不调用真实 API
```

**用途**: 离线开发和测试，不消耗 API 额度

---

## 🚀 优化建议

### 1. 启用缓存（已启用）

```yaml
performance:
  cache_embeddings: true  # ✅ 已启用
```

**效果**: 相同序列不会重复调用 API，节省时间和费用

### 2. 批量处理

```yaml
performance:
  batch_size: 10  # 当前配置
  max_workers: 4  # 并行数
```

**说明**: 虽然当前 SDK 是逐个调用，但框架已支持批量，未来 SDK 升级后可自动受益

### 3. 调整窗口大小

```yaml
sequence_context:
  window_size: 2000  # 当前 2000bp
```

**权衡**:
- **减小窗口** (如 1000bp): 更快，但可能丢失远程调控元件信息
- **增大窗口** (如 5000bp): 更全面，但更慢且费用更高

---

## 📈 API 用量监控

### 查看用量

登录华大云平台:
```
https://cloud.stomics.tech
→ 控制台
→ API 统计
```

### 预估费用

**假设**: 每次 API 调用 0.1 元（示例价格，请查看官方定价）

| 项目规模 | API 调用次数 | 预估费用 |
|---------|------------|---------|
| 测试 (10 变异) | ~20 | ~2 元 |
| 小型项目 (100 变异) | ~200 | ~20 元 |
| 中型项目 (1000 变异) | ~2000 | ~200 元 |

**节省建议**:
- ✅ 启用缓存（已启用）
- ✅ 先用 1.2B 模型筛查，再用 10B 精确分析
- ✅ 过滤低质量变异

---

## ✅ 配置验证

运行以下命令验证当前配置:

```powershell
# 查看配置
type configs\run.yaml | findstr "model_name"

# 应输出
# model_name: "Genos-10B"  # Genos-1.2B 或 Genos-10B
```

测试 API 连接:
```powershell
.\快速测试.bat
```

预期输出:
```
✓ Genos DCS 客户端初始化成功: 模型 Genos-10B
```

---

## 🔄 配置历史

| 时间 | 配置变更 | 原因 |
|------|---------|------|
| 2026-01-08 14:00 | 从本地 HTTP 迁移到 DCS API | 官方云服务，无需本地部署 |
| 2026-01-08 14:30 | 设置 API Token | 用户提供 Token |
| 2026-01-08 14:35 | **切换到 Genos-10B** | **用户要求，追求最高精度** ⭐ |

---

## 📚 相关文档

- [立即开始.md](立即开始.md) - 快速上手
- [DCS_API配置指南.md](DCS_API配置指南.md) - 详细配置
- [迁移到DCS_API.md](迁移到DCS_API.md) - 技术细节

---

**配置状态**: ✅ Genos-10B 已启用
**更新时间**: 2026-01-08
