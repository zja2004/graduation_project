# 🚀 立即开始使用 Genos DCS API

您的 API Token 已配置完成！

## ⚡ 三种运行方式

### 方式 1: 快速测试（推荐）

双击运行：
```
快速测试.bat
```

这个脚本会：
1. ✅ 自动设置您的 API Token
2. ✅ 测试 DCS API 连接
3. ✅ 询问是否运行完整分析
4. ✅ 显示分析报告

**预期输出**:
```
============================================================
Genos DCS API 快速测试
============================================================

[步骤 1] 设置 API Token...
✓ Token 已设置: sk-NSsjvPwgyb0KhiD...

[步骤 2] 测试 DCS API 连接...
✓ Genos DCS 客户端初始化成功: 模型 Genos-10B
⏱️  Embedding extraction completed in 1.2345s

✓ API 连接测试通过！

[步骤 3] 是否运行完整分析流程？
选择 (Y=是, N=否) [Y,N]?
```

---

### 方式 2: 永久设置 Token

如果您想要永久设置 Token（所有命令行窗口都生效），运行：

```powershell
.\永久设置API_Token.ps1
```

或直接在 PowerShell 中运行：
```powershell
[System.Environment]::SetEnvironmentVariable("GENOS_API_TOKEN", "sk-NSsjvPwgyb0KhiDA7uaiXVsnKaz_4mryvt530EFS5SqcI8o-", "User")
```

---

### 方式 3: 手动运行

```powershell
# 1. 设置 Token (当前窗口)
$env:GENOS_API_TOKEN="sk-NSsjvPwgyb0KhiDA7uaiXVsnKaz_4mryvt530EFS5SqcI8o-"

# 2. 测试 API 连接
python tools\genos_client.py

# 3. 运行完整分析
python main.py --vcf examples\test.vcf --output runs\my_test --sample demo
```

---

## 📊 预期结果

### API 测试成功

当运行 `快速测试.bat` 时，您应该看到：

```
=== 测试模拟模式 ===
✓ Genos 模拟模式已启用
...

=== 测试官方 DCS API ===
✓ Genos DCS 客户端初始化成功: 模型 Genos-10B

测试真实 Embedding...
⏱️  Embedding extraction completed in 1.2345s (sequence_length=400)
Real embedding shape: (更高维度)
Real embedding mean: 0.0012
```

### 完整分析流程

如果运行完整分析，输出文件在 `runs/api_test/`:

```
runs/api_test/
├── plan.yaml                    # 执行计划
├── variants.filtered.vcf        # 筛选后变异
├── contexts.jsonl               # 序列上下文
├── genos_embeddings.parquet     # DCS API 返回的 embeddings ⭐
├── scores.tsv                   # 变异评分
├── evidence.json                # 证据检索
├── report.md                    # 分析报告
├── critic_report.json           # Critic 审校
└── pipeline.log                 # 运行日志
```

---

## 🔧 配置说明

### 当前配置

您的 Token 已配置在以下脚本中：

1. **设置API_Token.bat** - 临时设置（当前窗口）
2. **永久设置API_Token.ps1** - 永久设置（系统环境变量）
3. **快速测试.bat** - 内置 Token 的一键测试

### 模型配置

当前使用 **Genos-10B** 模型（百亿参数级）。如需切换回 1.2B 模型，编辑 `configs/run.yaml`:

```yaml
genos:
  model_name: "Genos-1.2B"  # 切换为 1.2B 模型
```

**模型对比**:
- **Genos-1.2B**: 12亿参数，速度快，embedding 维度 4096
- **Genos-10B**: 100亿参数，精度高，embedding 维度更高（当前配置）⭐

### 模拟模式

如需离线测试（不调用真实 API），编辑 `configs/run.yaml`:

```yaml
genos:
  mock_mode: true  # 启用模拟模式
```

---

## ⚠️ 安全提示

### Token 保护

您的 Token 已经写入到以下文件中：
- ✅ `设置API_Token.bat`
- ✅ `永久设置API_Token.ps1`
- ✅ `快速测试.bat`

**重要**:
- ❌ **不要**将这些文件分享给他人
- ❌ **不要**将这些文件提交到公开的 Git 仓库
- ✅ 如需分享代码，请先删除 Token

### 撤销 Token

如果 Token 泄露，请访问 [https://cloud.stomics.tech](https://cloud.stomics.tech) → API 管理 → 撤销并重新生成。

---

## 📈 使用统计

### API 调用量预估

对于测试 VCF (10 个变异):

| 任务 | API 调用次数 | 预计时间 |
|------|------------|---------|
| Embedding 生成 | 20 次 (ref + alt) | ~15-20s |
| 总计 | ~20 次 | ~20-30s |

真实项目（100 个变异）:
- API 调用: ~200 次
- 预计时间: ~3-5 分钟

### 监控用量

登录华大云平台查看 API 用量:
```
https://cloud.stomics.tech → 控制台 → API 统计
```

---

## 🎯 下一步

### 立即测试

```powershell
# 双击运行
快速测试.bat
```

### 使用自己的 VCF 文件

```powershell
# 设置 Token (如果未永久设置)
$env:GENOS_API_TOKEN="sk-NSsjvPwgyb0KhiDA7uaiXVsnKaz_4mryvt530EFS5SqcI8o-"

# 运行分析
python main.py --vcf your_file.vcf --output runs/my_analysis --sample patient_001
```

### 查看报告

```powershell
# 在记事本中打开
notepad runs\api_test\report.md

# 或在命令行查看
type runs\api_test\report.md
```

---

## 📚 详细文档

- [DCS_API配置指南.md](DCS_API配置指南.md) - 完整配置教程
- [迁移到DCS_API.md](迁移到DCS_API.md) - 技术细节
- [环境配置指南.md](环境配置指南.md) - 故障排除

---

## ✅ 快速检查清单

在运行之前，确认：

- [x] API Token 已配置 (`sk-NSsjvPwgyb0KhiDA7uaiXVsnKaz_4mryvt530EFS5SqcI8o-`)
- [x] 网络连接正常
- [x] Python 环境已安装
- [x] 依赖包已安装 (`pip install numpy pandas pyyaml requests pyarrow`)
- [x] 测试 VCF 文件存在 (`examples\test.vcf`)

---

**准备就绪！现在就运行 `快速测试.bat` 开始使用吧！** 🚀
