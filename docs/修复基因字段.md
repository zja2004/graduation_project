# ğŸ”§ åŸºå› å­—æ®µä¿®å¤æŒ‡å—

## é—®é¢˜è¯Šæ–­

AI é€šä¿—åŒ–è§£é‡ŠåŠŸèƒ½å·²ç»å®ç°ï¼Œä½†**æ²¡æœ‰ç”Ÿæˆè§£é‡Š**çš„åŸå› æ˜¯ï¼š

è¯„åˆ†æ–‡ä»¶ï¼ˆ`scores.tsv`ï¼‰ä¸­**ç¼ºå°‘ `gene` åˆ—**ï¼Œå¯¼è‡´ RAG Agent æ— æ³•è¯†åˆ«åŸºå› åç§°ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: ä½¿ç”¨å¸¦åŸºå› æ³¨é‡Šçš„æµ‹è¯• VCFï¼ˆæ¨èï¼‰

æˆ‘å·²ç»ä¸ºæ‚¨åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æµ‹è¯• VCF æ–‡ä»¶ï¼š

**[examples/test_with_genes.vcf](examples/test_with_genes.vcf)** â­

è¿™ä¸ªæ–‡ä»¶åŒ…å« 8 ä¸ªçŸ¥åçš„ç™Œç—‡ç›¸å…³åŸºå› å˜å¼‚ï¼š
- **BRAF** V600E - é»‘è‰²ç´ ç˜¤
- **TP53** - è‚¿ç˜¤æŠ‘åˆ¶åŸºå› 
- **JAK2** - éª¨é«“å¢æ®–æ€§ç–¾ç—…
- **BRCA2** - ä¹³è…ºç™Œ/åµå·¢ç™Œ
- **BRCA1** - ä¹³è…ºç™Œ/åµå·¢ç™Œ
- **KRAS** - ç»“ç›´è‚ ç™Œ/è‚ºç™Œ
- **MAP2K1** - é»‘è‰²ç´ ç˜¤
- **PIK3CA** - å¤šç§ç™Œç—‡

### ç«‹å³æµ‹è¯•

```powershell
# è®¾ç½® API Tokens
$env:GENOS_API_TOKEN="sk-NSsjvPwgyb0KhiDA7uaiXVsnKaz_4mryvt530EFS5SqcI8o-"

# ä½¿ç”¨å¸¦åŸºå› æ³¨é‡Šçš„ VCF è¿è¡Œ
python main.py --vcf examples\test_with_genes.vcf --output runs\gene_test --sample with_ai_explanation

# æŸ¥çœ‹ HTML æŠ¥å‘Šï¼ˆä¼šåŒ…å« AI è§£é‡Šï¼‰
start runs\gene_test\report.html
```

---

### æ–¹æ¡ˆ 2: ä¿®æ”¹ä»£ç è‡ªåŠ¨æå–åŸºå› ä¿¡æ¯

å¦‚æœæ‚¨çš„ VCF æ–‡ä»¶åœ¨ INFO å­—æ®µä¸­æœ‰ `GENE` æ ‡ç­¾ï¼Œæˆ‘å¯ä»¥ä¿®æ”¹ä»£ç è‡ªåŠ¨æå–ã€‚

#### æ­¥éª¤ 1: æ£€æŸ¥æ‚¨çš„ VCF æ ¼å¼

```powershell
# æŸ¥çœ‹ VCF çš„ INFO å­—æ®µ
head -20 your_file.vcf | grep "##INFO"
```

å¦‚æœçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å®šä¹‰ï¼š
```
##INFO=<ID=GENE,Number=1,Type=String,Description="Gene Symbol">
```

æˆ–è€… CSQ å­—æ®µåŒ…å«åŸºå› ä¿¡æ¯ï¼š
```
##INFO=<ID=CSQ,Number=.,Type=String,Description="Consequence|Gene|...">
```

#### æ­¥éª¤ 2: ä¿®æ”¹è¯„åˆ†æ¨¡å—

éœ€è¦ä¿®æ”¹ `agents/executor/scoring.py`ï¼Œåœ¨ç”Ÿæˆè¯„åˆ†æ–‡ä»¶æ—¶æ·»åŠ  `gene` åˆ—ã€‚

---

## ğŸ§ª éªŒè¯ AI è§£é‡Šæ˜¯å¦ç”Ÿæˆ

è¿è¡Œåˆ†æåï¼Œæ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š

### 1. æŸ¥çœ‹æ—¥å¿—

```powershell
type runs\gene_test\pipeline.log | findstr "DeepSeek"
```

åº”è¯¥çœ‹åˆ°ï¼š
```
âœ“ DeepSeek å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸï¼ˆç”¨äºç”ŸæˆåŸºå› è§£é‡Šï¼‰
âœ“ ç”ŸæˆåŸºå› è§£é‡Š: BRAF
âœ“ ç”ŸæˆåŸºå› è§£é‡Š: TP53
...
âœ“ AIé€šä¿—åŒ–è§£é‡Šç”Ÿæˆ: 8/8 ä¸ªå˜å¼‚
```

### 2. æ£€æŸ¥è¯æ®æ–‡ä»¶

```powershell
python -c "import json; e=json.load(open('runs/gene_test/evidence.json', encoding='utf-8')); print('åŒ…å«AIè§£é‡Šçš„å˜å¼‚æ•°:', sum(1 for v in e.values() if v.get('gene_explanation')))"
```

åº”è¯¥è¾“å‡ºï¼š`åŒ…å«AIè§£é‡Šçš„å˜å¼‚æ•°: 8`

### 3. æŸ¥çœ‹å•ä¸ª AI è§£é‡Š

```powershell
python -c "import json; e=json.load(open('runs/gene_test/evidence.json', encoding='utf-8')); vid=list(e.keys())[0]; print(e[vid].get('gene_explanation', 'æœªç”Ÿæˆ'))"
```

åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
```
### 1. åŸºå› çš„ä½œç”¨
BRAF åŸºå› å°±åƒèº«ä½“é‡Œçš„ä¸€ä¸ª"ä¿¡å·ä¼ é€’å‘˜"...

### 2. è›‹ç™½è´¨çš„å˜åŒ–
è¿™ä¸ªå˜å¼‚ä¼šå¯¼è‡´ BRAF è›‹ç™½è´¨å˜æˆ...

### 3. å¯èƒ½çš„å¥åº·å½±å“
è¿™ç§å˜å¼‚ä¸é»‘è‰²ç´ ç˜¤å’Œç»“ç›´è‚ ç™Œé«˜åº¦ç›¸å…³...
```

### 4. æŸ¥çœ‹ HTML æŠ¥å‘Š

æ‰“å¼€ `runs\gene_test\report.html`ï¼Œåœ¨æ¯ä¸ªå˜å¼‚ä¸‹æ–¹åº”è¯¥çœ‹åˆ°ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– AI é€šä¿—åŒ–è§£é‡Š              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ### 1. åŸºå› çš„ä½œç”¨             â”‚
â”‚ ...                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ å®Œæ•´æµ‹è¯•æµç¨‹

åˆ›å»ºä¸€ä¸ªæµ‹è¯•è„šæœ¬ï¼š

```powershell
# ä¿å­˜ä¸º test_ai_explanation.bat
@echo off
echo ============================================================
echo æµ‹è¯• AI é€šä¿—åŒ–è§£é‡ŠåŠŸèƒ½
echo ============================================================
echo.

echo [1/4] è®¾ç½® API Token...
set GENOS_API_TOKEN=sk-NSsjvPwgyb0KhiDA7uaiXVsnKaz_4mryvt530EFS5SqcI8o-
echo âœ“ Token å·²è®¾ç½®

echo.
echo [2/4] è¿è¡Œåˆ†æï¼ˆä½¿ç”¨å¸¦åŸºå› æ³¨é‡Šçš„ VCFï¼‰...
python main.py --vcf examples\test_with_genes.vcf --output runs\gene_test --sample ai_demo

echo.
echo [3/4] æ£€æŸ¥ AI è§£é‡Šç”Ÿæˆæƒ…å†µ...
python -c "import json; e=json.load(open('runs/gene_test/evidence.json', encoding='utf-8')); count=sum(1 for v in e.values() if v.get('gene_explanation')); print(f'\nâœ“ AIè§£é‡Šç”ŸæˆæˆåŠŸ: {count}/{len(e)} ä¸ªå˜å¼‚')"

echo.
echo [4/4] æ‰“å¼€ HTML æŠ¥å‘Š...
start runs\gene_test\report.html

echo.
echo ============================================================
echo æµ‹è¯•å®Œæˆï¼è¯·åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹æŠ¥å‘Š
echo ============================================================
pause
```

è¿è¡Œï¼š
```powershell
.\test_ai_explanation.bat
```

---

## ğŸ“Š é¢„æœŸç»“æœ

### è¯æ®æ–‡ä»¶ (evidence.json)

```json
{
  "rs113488022": {
    "variant_id": "rs113488022",
    "chrom": "chr7",
    "pos": 140753336,
    "ref": "A",
    "alt": "T",
    "sources": [...],
    "gene_explanation": "### 1. åŸºå› çš„ä½œç”¨\nBRAF åŸºå› å°±åƒèº«ä½“é‡Œçš„ä¸€ä¸ª'ä¿¡å·ä¼ é€’å‘˜'ï¼Œè´Ÿè´£æŠŠç»†èƒå¤–çš„ç”Ÿé•¿ä¿¡å·ä¼ é€’ç»™ç»†èƒæ ¸ã€‚å®ƒå‘Šè¯‰ç»†èƒä»€ä¹ˆæ—¶å€™è¯¥åˆ†è£‚ç”Ÿé•¿ï¼Œä»€ä¹ˆæ—¶å€™è¯¥åœä¸‹æ¥ä¼‘æ¯ã€‚\n\n### 2. è›‹ç™½è´¨çš„å˜åŒ–\nè¿™ä¸ªå˜å¼‚ï¼ˆåŒ»å­¦ä¸Šå« V600E çªå˜ï¼‰ä¼šè®© BRAF è›‹ç™½è´¨å˜æˆä¸€ä¸ª'åœä¸ä¸‹æ¥çš„ä¼ ä»¤å…µ'ã€‚æ­£å¸¸çš„ BRAF è›‹ç™½è´¨åƒä¸ªè´Ÿè´£ä»»çš„å‘˜å·¥ï¼Œå·¥ä½œå®Œå°±ä¼‘æ¯ã€‚ä½†å˜å¼‚åçš„è›‹ç™½è´¨ä¼šä¸€ç›´ä¿æŒ'å·¥ä½œçŠ¶æ€'ï¼Œä¸æ–­å‘å‡º'å¿«é€Ÿç”Ÿé•¿'çš„ä¿¡å·ã€‚\n\n### 3. å¯èƒ½çš„å¥åº·å½±å“\nè¿™ç§å˜å¼‚ä¸å¤šç§ç™Œç—‡é«˜åº¦ç›¸å…³ï¼Œç‰¹åˆ«æ˜¯é»‘è‰²ç´ ç˜¤ï¼ˆä¸€ç§çš®è‚¤ç™Œï¼‰å’Œç»“ç›´è‚ ç™Œã€‚å¦‚æœæ£€æµ‹åˆ°è¿™ä¸ªå˜å¼‚ï¼Œå»ºè®®åŠæ—¶å’¨è¯¢è‚¿ç˜¤ä¸“ç§‘åŒ»ç”Ÿï¼Œå®šæœŸçš®è‚¤å’Œè‚ é•œæ£€æŸ¥ã€‚å¥½æ¶ˆæ¯æ˜¯ï¼Œç°åœ¨æœ‰é’ˆå¯¹æ€§çš„é¶å‘è¯ç‰©ï¼ˆå¦‚å¨ç½—è²å°¼ï¼‰ã€‚"
  }
}
```

### HTML æŠ¥å‘Šæ•ˆæœ

æµè§ˆå™¨ä¸­ä¼šçœ‹åˆ°ç¾è§‚çš„AIè§£é‡Šå¡ç‰‡ï¼ŒåŒ…å«ï¼š
- ğŸ¤– å›¾æ ‡
- æ¸å˜è“è‰²èƒŒæ™¯
- ä¸‰éƒ¨åˆ†æ¸…æ™°çš„è§£é‡Š
- å…è´£å£°æ˜

---

## âš ï¸ å¦‚æœä»ç„¶æ²¡æœ‰ç”Ÿæˆè§£é‡Š

### æ’æŸ¥æ­¥éª¤

1. **æ£€æŸ¥è¯„åˆ†æ–‡ä»¶æ˜¯å¦æœ‰ gene åˆ—**
   ```powershell
   head -1 runs\gene_test\scores.tsv
   ```

   åº”è¯¥åŒ…å« `gene` åˆ—ã€‚

2. **æ£€æŸ¥ DeepSeek API æ˜¯å¦æ­£å¸¸**
   ```powershell
   python -c "from tools.deepseek_client import create_deepseek_client; import yaml; c=create_deepseek_client(yaml.safe_load(open('configs/run.yaml', encoding='utf-8'))); print(c.generate_gene_explanation('BRAF', {'chrom':'chr7','pos':140753336,'ref':'A','alt':'T','impact_level':'HIGH'}))"
   ```

3. **æŸ¥çœ‹å®Œæ•´æ—¥å¿—**
   ```powershell
   type runs\gene_test\pipeline.log
   ```

---

## ğŸ› ï¸ è‡ªåŠ¨ä¿®å¤è„šæœ¬ï¼ˆé«˜çº§ï¼‰

å¦‚æœéœ€è¦è‡ªåŠ¨ä» INFO å­—æ®µæå–åŸºå› ä¿¡æ¯ï¼Œæˆ‘å¯ä»¥åˆ›å»ºä¸€ä¸ªè¡¥ä¸è„šæœ¬ã€‚

è®©æˆ‘çŸ¥é“æ‚¨çš„ VCF æ ¼å¼ï¼Œæˆ‘ä¼šä¸ºæ‚¨å®šåˆ¶ï¼

---

**çŠ¶æ€**: âœ… æ–°æµ‹è¯• VCF å·²åˆ›å»º
**æ–‡ä»¶**: [examples/test_with_genes.vcf](examples/test_with_genes.vcf)
**ä¸‹ä¸€æ­¥**: è¿è¡Œ `python main.py --vcf examples\test_with_genes.vcf --output runs\gene_test --sample ai_demo`
