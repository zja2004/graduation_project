# ğŸ¤– AI é€šä¿—åŒ–è§£é‡ŠåŠŸèƒ½ä½¿ç”¨æŒ‡å—

## âœ… åŠŸèƒ½å·²å°±ç»ª

æ‚¨çš„åŸºå› ç»„åˆ†æç³»ç»Ÿç°åœ¨å·²é›†æˆ **DeepSeek LLM**ï¼Œèƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆå°ç™½å‹å¥½çš„åŸºå› å˜å¼‚è§£é‡Šï¼

---

## ğŸ¯ æ–°åŠŸèƒ½æ¦‚è¿°

### è‡ªåŠ¨ç”Ÿæˆä¸‰éƒ¨åˆ†è§£é‡Š

å¯¹äºæ¯ä¸ªå˜å¼‚ï¼ŒAI ä¼šè‡ªåŠ¨ç”Ÿæˆï¼š

1. **åŸºå› çš„ä½œç”¨**
   - è¯¥åŸºå› åœ¨äººä½“å†…è´Ÿè´£ä»€ä¹ˆåŠŸèƒ½ï¼Ÿ
   - ç”¨é€šä¿—çš„è¯­è¨€å’Œæ¯”å–»è§£é‡Š

2. **è›‹ç™½è´¨çš„å˜åŒ–**
   - è¿™ä¸ªå˜å¼‚ä¼šå¯¼è‡´ä»€ä¹ˆè›‹ç™½è´¨å‘ç”Ÿå˜åŒ–ï¼Ÿ
   - è›‹ç™½è´¨åŠŸèƒ½ä¼šå—åˆ°ä»€ä¹ˆå½±å“ï¼Ÿ

3. **å¯èƒ½çš„å¥åº·å½±å“**
   - è¿™ç§å˜å¼‚ä¸å“ªäº›ç–¾ç—…æˆ–ç—‡çŠ¶ç›¸å…³ï¼Ÿ
   - éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ

### ç‰¹ç‚¹

- âœ… **å°ç™½å‹å¥½** - é¿å…ä¸“ä¸šæœ¯è¯­
- âœ… **è‡ªåŠ¨ç”Ÿæˆ** - æ— éœ€äººå·¥ç¼–å†™
- âœ… **å®æ—¶è°ƒç”¨** - æ¯æ¬¡åˆ†æéƒ½è·å–æœ€æ–°è§£é‡Š
- âœ… **ç¾è§‚å±•ç¤º** - HTML æŠ¥å‘Šä¸­ç²¾ç¾å‘ˆç°

---

## ğŸš€ ç«‹å³æµ‹è¯•

### æ–¹å¼ 1: å¿«é€Ÿæµ‹è¯•ï¼ˆæ¨èï¼‰

```powershell
# è®¾ç½® API Tokens
$env:GENOS_API_TOKEN="sk-NSsjvPwgyb0KhiDA7uaiXVsnKaz_4mryvt530EFS5SqcI8o-"

# è¿è¡Œåˆ†æï¼ˆä¼šè‡ªåŠ¨ç”ŸæˆAIè§£é‡Šï¼‰
python main.py --vcf examples\test.vcf --output runs\ai_test --sample demo_with_ai

# æŸ¥çœ‹ HTML æŠ¥å‘Šï¼ˆåŒ…å«AIè§£é‡Šï¼‰
runs\ai_test\report.html
```

### æ–¹å¼ 2: ä½¿ç”¨å¿«é€Ÿæµ‹è¯•è„šæœ¬

```powershell
.\å¿«é€Ÿæµ‹è¯•.bat
```

é€‰æ‹© Y è¿è¡Œå®Œæ•´åˆ†æï¼ŒæŠ¥å‘Šä¸­ä¼šè‡ªåŠ¨åŒ…å«AIè§£é‡Šã€‚

---

## ğŸ“Š è¾“å‡ºç¤ºä¾‹

### è¯æ®æ–‡ä»¶ (evidence.json)

```json
{
  "rs123456": {
    "variant_id": "rs123456",
    "chrom": "chr7",
    "pos": 140753336,
    "ref": "A",
    "alt": "T",
    "sources": [
      {
        "source": "ClinVar",
        "data": {...}
      }
    ],
    "gene_explanation": "### 1. åŸºå› çš„ä½œç”¨\nBRAF åŸºå› å°±åƒèº«ä½“é‡Œçš„ä¸€ä¸ª'å¼€å…³æ§åˆ¶å™¨'ï¼Œè´Ÿè´£è°ƒèŠ‚ç»†èƒçš„ç”Ÿé•¿å’Œåˆ†è£‚...\n\n### 2. è›‹ç™½è´¨çš„å˜åŒ–\nè¿™ä¸ªå˜å¼‚ä¼šå¯¼è‡´ BRAF è›‹ç™½è´¨å‘ç”Ÿæ”¹å˜...\n\n### 3. å¯èƒ½çš„å¥åº·å½±å“\nè¿™ç§å˜å¼‚ä¸é»‘è‰²ç´ ç˜¤å’Œç»“ç›´è‚ ç™Œé«˜åº¦ç›¸å…³..."
  }
}
```

### HTML æŠ¥å‘Šæ•ˆæœ

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `runs/ai_test/report.html`ï¼Œæ¯ä¸ªå˜å¼‚ä¸‹æ–¹ä¼šæ˜¾ç¤ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ rs123456 (chr7:140753336)               â”‚
â”‚ A â†’ T                                    â”‚
â”‚ é«˜é£é™© | AI è¯„åˆ†: 0.95                  â”‚
â”‚                                          â”‚
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚
â”‚ â•‘ ğŸ¤– AI é€šä¿—åŒ–è§£é‡Š                  â•‘   â”‚
â”‚ â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£   â”‚
â”‚ â•‘                                    â•‘   â”‚
â”‚ â•‘ ### 1. åŸºå› çš„ä½œç”¨                 â•‘   â”‚
â”‚ â•‘ BRAF åŸºå› å°±åƒèº«ä½“é‡Œçš„ä¸€ä¸ª         â•‘   â”‚
â”‚ â•‘ "å¼€å…³æ§åˆ¶å™¨"ï¼Œè´Ÿè´£è°ƒèŠ‚ç»†èƒçš„      â•‘   â”‚
â”‚ â•‘ ç”Ÿé•¿å’Œåˆ†è£‚...                     â•‘   â”‚
â”‚ â•‘                                    â•‘   â”‚
â”‚ â•‘ ### 2. è›‹ç™½è´¨çš„å˜åŒ–               â•‘   â”‚
â”‚ â•‘ è¿™ä¸ªå˜å¼‚ä¼šå¯¼è‡´ BRAF è›‹ç™½è´¨        â•‘   â”‚
â”‚ â•‘ å‘ç”Ÿæ”¹å˜...                        â•‘   â”‚
â”‚ â•‘                                    â•‘   â”‚
â”‚ â•‘ ### 3. å¯èƒ½çš„å¥åº·å½±å“             â•‘   â”‚
â”‚ â•‘ è¿™ç§å˜å¼‚ä¸é»‘è‰²ç´ ç˜¤å’Œç»“ç›´è‚ ç™Œ      â•‘   â”‚
â”‚ â•‘ é«˜åº¦ç›¸å…³...                        â•‘   â”‚
â”‚ â•‘                                    â•‘   â”‚
â”‚ â•‘ ğŸ’¡ æ­¤è§£é‡Šç”± DeepSeek AI è‡ªåŠ¨      â•‘   â”‚
â”‚ â•‘    ç”Ÿæˆï¼Œä»…ä¾›å‚è€ƒç†è§£             â•‘   â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### å½“å‰é…ç½®

[configs/run.yaml](configs/run.yaml#L19-23):

```yaml
deepseek:
  api_key: "sk-68084dca40ca44eebfd9455a4f502a2a"  # å·²é…ç½®
  model: "deepseek-chat"
  base_url: "https://api.deepseek.com"
```

### å¯ç”¨/ç¦ç”¨ AI è§£é‡Š

**ç¦ç”¨æ–¹æ³• 1**: æ³¨é‡Šæ‰ API Key

```yaml
deepseek:
  api_key: null  # è®¾ä¸º null ç¦ç”¨AIè§£é‡Š
```

**ç¦ç”¨æ–¹æ³• 2**: ä¸´æ—¶ç¦ç”¨

```python
# åœ¨ agents/executor/evidence_rag.py çš„ _init_deepseek_client() ä¸­
self.deepseek_client = None  # å¼ºåˆ¶ç¦ç”¨
```

ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ï¼Œå¦‚æœ DeepSeek å®¢æˆ·ç«¯ä¸å¯ç”¨ï¼Œä¼šè·³è¿‡AIè§£é‡Šç”Ÿæˆï¼Œä¸å½±å“å…¶ä»–åŠŸèƒ½ã€‚

---

## ğŸ“ˆ æ€§èƒ½ä¸æˆæœ¬

### å¤„ç†æ—¶é—´

å¯¹äº **10 ä¸ªå˜å¼‚**ï¼ˆæµ‹è¯• VCFï¼‰ï¼š
- ä¸ä½¿ç”¨ AI è§£é‡Š: ~30-40s
- **ä½¿ç”¨ AI è§£é‡Š**: ~45-60sï¼ˆæ¯ä¸ªè§£é‡Šçº¦1.5-2.5sï¼‰

å¯¹äº **100 ä¸ªå˜å¼‚**ï¼š
- ä¸ä½¿ç”¨ AI è§£é‡Š: ~6-7 åˆ†é’Ÿ
- **ä½¿ç”¨ AI è§£é‡Š**: ~9-11 åˆ†é’Ÿ

### API è´¹ç”¨é¢„ä¼°

**DeepSeek API å®šä»·**ï¼ˆ2026å¹´å‚è€ƒä»·ï¼‰ï¼š
- è¾“å…¥: Â¥0.001 / 1K tokens
- è¾“å‡º: Â¥0.002 / 1K tokens

**æ¯æ¬¡è§£é‡Šæˆæœ¬**ï¼š
- è¾“å…¥: ~200 tokens Ã— Â¥0.001 = Â¥0.0002
- è¾“å‡º: ~300 tokens Ã— Â¥0.002 = Â¥0.0006
- **æ€»è®¡**: ~Â¥0.001 / ä¸ªè§£é‡Š

**é¡¹ç›®æ€»æˆæœ¬**ï¼š
| å˜å¼‚æ•°é‡ | Genos 10B API | DeepSeek API | æ€»è®¡ |
|---------|--------------|-------------|------|
| 10 ä¸ª   | ~Â¥2          | ~Â¥0.01      | ~Â¥2.01 |
| 100 ä¸ª  | ~Â¥20         | ~Â¥0.10      | ~Â¥20.10 |
| 1000 ä¸ª | ~Â¥200        | ~Â¥1.00      | ~Â¥201 |

**ç»“è®º**: DeepSeek API æˆæœ¬æä½ï¼Œä»…å æ€»æˆæœ¬çš„ 0.5%ï¼

---

## ğŸ” éªŒè¯åŠŸèƒ½

### æ£€æŸ¥ AI è§£é‡Šæ˜¯å¦ç”Ÿæˆ

```powershell
# è¿è¡Œåˆ†æ
python main.py --vcf examples\test.vcf --output runs\verify --sample test

# æ£€æŸ¥æ—¥å¿—ä¸­çš„æç¤º
# åº”è¯¥çœ‹åˆ°:
# âœ“ DeepSeek å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸï¼ˆç”¨äºç”ŸæˆåŸºå› è§£é‡Šï¼‰
# âœ“ AIé€šä¿—åŒ–è§£é‡Šç”Ÿæˆ: X/10 ä¸ªå˜å¼‚

# æŸ¥çœ‹è¯æ®æ–‡ä»¶
python -c "import json; e=json.load(open('runs/verify/evidence.json', encoding='utf-8')); print('AIè§£é‡Šæ•°é‡:', sum(1 for v in e.values() if v.get('gene_explanation')))"
```

### æŸ¥çœ‹å•ä¸ªè§£é‡Š

```powershell
python -c "import json; e=json.load(open('runs/verify/evidence.json', encoding='utf-8')); vid=list(e.keys())[0]; print(e[vid].get('gene_explanation', 'æœªç”Ÿæˆ'))"
```

---

## ğŸ¨ è‡ªå®šä¹‰ AI è§£é‡Š

### ä¿®æ”¹ Prompt æ¨¡æ¿

ç¼–è¾‘ [tools/deepseek_client.py](tools/deepseek_client.py)ï¼Œæ‰¾åˆ° `_build_explanation_prompt()` æ–¹æ³•ï¼ˆçº¦ç¬¬ 50 è¡Œï¼‰ï¼š

```python
prompt = f"""
è¯·ç”¨**ç®€å•æ˜“æ‡‚**çš„è¯­è¨€è§£é‡Šä»¥ä¸‹åŸºå› å˜å¼‚ä¿¡æ¯...

# å¯ä»¥æ·»åŠ æ›´å¤šè¦æ±‚ï¼Œå¦‚ï¼š
# - è¯·ç”¨æ¯”å–»çš„æ–¹å¼è§£é‡Š
# - å­—æ•°é™åˆ¶åœ¨ 150 å­—ä»¥å†…
# - å¼ºè°ƒä¸´åºŠæ„ä¹‰
"""
```

### è°ƒæ•´æ¸©åº¦å‚æ•°

```python
# åœ¨ generate_gene_explanation() æ–¹æ³•ä¸­
explanation = self.chat_completion(messages, temperature=0.3, max_tokens=600)

# temperature è¶Šä½(0.1)ï¼Œè¾“å‡ºè¶Šä¿å®ˆä¸€è‡´
# temperature è¶Šé«˜(0.7)ï¼Œè¾“å‡ºè¶Šå¤šæ ·åˆ›é€ æ€§
```

---

## ğŸ“ å®é™…ä½¿ç”¨æ¡ˆä¾‹

### æ¡ˆä¾‹ 1: BRAF V600E çªå˜

**è¾“å…¥**:
```json
{
  "gene": "BRAF",
  "chrom": "chr7",
  "pos": 140753336,
  "ref": "A",
  "alt": "T",
  "impact_level": "HIGH"
}
```

**AI ç”Ÿæˆçš„è§£é‡Š**ï¼ˆç¤ºä¾‹ï¼‰:

```markdown
### 1. åŸºå› çš„ä½œç”¨
BRAF åŸºå› å°±åƒèº«ä½“é‡Œçš„ä¸€ä¸ª"ä¿¡å·ä¼ é€’å‘˜"ï¼Œè´Ÿè´£æŠŠç»†èƒå¤–çš„ç”Ÿé•¿ä¿¡å·ä¼ é€’ç»™ç»†èƒæ ¸ã€‚
å®ƒå‘Šè¯‰ç»†èƒä»€ä¹ˆæ—¶å€™è¯¥åˆ†è£‚ç”Ÿé•¿ï¼Œä»€ä¹ˆæ—¶å€™è¯¥åœä¸‹æ¥ä¼‘æ¯ã€‚

### 2. è›‹ç™½è´¨çš„å˜åŒ–
è¿™ä¸ªå˜å¼‚ï¼ˆåŒ»å­¦ä¸Šå« V600E çªå˜ï¼‰ä¼šè®© BRAF è›‹ç™½è´¨å˜æˆä¸€ä¸ª"åœä¸ä¸‹æ¥çš„ä¼ ä»¤å…µ"ã€‚
æ­£å¸¸çš„ BRAF è›‹ç™½è´¨åƒä¸ªè´Ÿè´£ä»»çš„å‘˜å·¥ï¼Œå·¥ä½œå®Œå°±ä¼‘æ¯ã€‚
ä½†å˜å¼‚åçš„è›‹ç™½è´¨ä¼šä¸€ç›´ä¿æŒ"å·¥ä½œçŠ¶æ€"ï¼Œä¸æ–­å‘å‡º"å¿«é€Ÿç”Ÿé•¿"çš„ä¿¡å·ã€‚

### 3. å¯èƒ½çš„å¥åº·å½±å“
è¿™ç§å˜å¼‚ä¸å¤šç§ç™Œç—‡é«˜åº¦ç›¸å…³ï¼Œç‰¹åˆ«æ˜¯ï¼š
- é»‘è‰²ç´ ç˜¤ï¼ˆä¸€ç§çš®è‚¤ç™Œï¼‰ - çº¦50%æ‚£è€…æœ‰æ­¤å˜å¼‚
- ç»“ç›´è‚ ç™Œ - çº¦10%æ‚£è€…æœ‰æ­¤å˜å¼‚

å¦‚æœæ£€æµ‹åˆ°è¿™ä¸ªå˜å¼‚ï¼š
âœ“ åŠæ—¶å’¨è¯¢è‚¿ç˜¤ä¸“ç§‘åŒ»ç”Ÿ
âœ“ å®šæœŸçš®è‚¤å’Œè‚ é•œæ£€æŸ¥
âœ“ å¥½æ¶ˆæ¯ï¼šæœ‰é’ˆå¯¹æ€§çš„é¶å‘è¯ç‰©ï¼ˆå¦‚å¨ç½—è²å°¼ï¼‰
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®è´¨é‡ä¾èµ–

AI è§£é‡Šçš„è´¨é‡å–å†³äºï¼š
- åŸºå› ä¿¡æ¯æ˜¯å¦å®Œæ•´ï¼ˆéœ€è¦æœ‰ `gene` å­—æ®µï¼‰
- å˜å¼‚æ³¨é‡Šæ˜¯å¦å‡†ç¡®
- DeepSeek æ¨¡å‹çš„çŸ¥è¯†åº“ï¼ˆæˆªæ­¢æ—¥æœŸï¼š2024å¹´åˆï¼‰

### 2. ä¸å¯ä½œä¸ºè¯Šæ–­ä¾æ®

- AI ç”Ÿæˆçš„è§£é‡Š**ä»…ä¾›ç§‘æ™®å‚è€ƒ**
- æŠ¥å‘Šä¸­å·²åŒ…å«å…è´£å£°æ˜
- æœ€ç»ˆè¯Šæ–­éœ€è¦ä¸“ä¸šåŒ»ç”Ÿå’Œé—ä¼ å’¨è¯¢å¸ˆ

### 3. API é™æµ

DeepSeek API å¯èƒ½æœ‰é€Ÿç‡é™åˆ¶ï¼š
- å¦‚æœå˜å¼‚æ•°é‡å¾ˆå¤§ï¼ˆ>100ï¼‰ï¼Œå¯èƒ½éœ€è¦åˆ†æ‰¹å¤„ç†
- é‡åˆ°é™æµæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è·³è¿‡è¯¥å˜å¼‚çš„è§£é‡Š

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ 1: æ²¡æœ‰ç”Ÿæˆ AI è§£é‡Š

**æ£€æŸ¥**:
```powershell
# æŸ¥çœ‹æ—¥å¿—
type runs\test\pipeline.log | findstr "DeepSeek"

# åº”è¯¥çœ‹åˆ°:
# âœ“ DeepSeek å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ
```

**å¯èƒ½åŸå› **:
- DeepSeek API Key æœªé…ç½®æˆ–æ— æ•ˆ
- å˜å¼‚æ•°æ®ä¸­ç¼ºå°‘ `gene` å­—æ®µ
- ç½‘ç»œè¿æ¥é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**:
```powershell
# æµ‹è¯• DeepSeek API
python -c "from tools.deepseek_client import create_deepseek_client; import yaml; c=create_deepseek_client(yaml.safe_load(open('configs/run.yaml', encoding='utf-8'))); print(c.generate_gene_explanation('BRAF', {'chrom':'chr7','pos':140753336,'ref':'A','alt':'T','impact_level':'HIGH'}))"
```

### é—®é¢˜ 2: è§£é‡Šè´¨é‡ä¸ç†æƒ³

**è°ƒæ•´æ–¹æ³•**:
1. ä¿®æ”¹ Prompt æ¨¡æ¿ï¼ˆæ›´å…·ä½“çš„è¦æ±‚ï¼‰
2. è°ƒæ•´æ¸©åº¦å‚æ•°ï¼ˆæ›´ä¿å®ˆæˆ–æ›´åˆ›é€ æ€§ï¼‰
3. å¢åŠ å­—æ•°é™åˆ¶ï¼ˆæ›´ç®€æ´æˆ–æ›´è¯¦ç»†ï¼‰

---

## âœ… åŠŸèƒ½æ£€æŸ¥æ¸…å•

- [x] DeepSeek å®¢æˆ·ç«¯å¢å¼º
- [x] RAG Agent é›†æˆ AI è§£é‡Š
- [x] æŠ¥å‘Šæ¨¡æ¿æ›´æ–°
- [x] HTML ç¾åŒ–æ˜¾ç¤º
- [x] é”™è¯¯å¤„ç†å’Œåå¤‡æ–¹æ¡ˆ
- [x] æˆæœ¬å’Œæ€§èƒ½ä¼˜åŒ–

---

## ğŸ‰ å¼€å§‹ä½¿ç”¨

ç«‹å³è¿è¡Œæµ‹è¯•ï¼Œä½“éªŒ AI é€šä¿—åŒ–è§£é‡Šï¼š

```powershell
.\å¿«é€Ÿæµ‹è¯•.bat
```

æˆ–æ‰‹åŠ¨è¿è¡Œï¼š

```powershell
$env:GENOS_API_TOKEN="sk-NSsjvPwgyb0KhiDA7uaiXVsnKaz_4mryvt530EFS5SqcI8o-"
python main.py --vcf examples\test.vcf --output runs\ai_demo --sample ai_test
start runs\ai_demo\report.html
```

æŸ¥çœ‹ç¾è§‚çš„ HTML æŠ¥å‘Šï¼Œæ¯ä¸ªå˜å¼‚éƒ½ä¼šæœ‰ ğŸ¤– AI é€šä¿—åŒ–è§£é‡Šï¼

---

**åŠŸèƒ½çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•å°±ç»ª
**ç‰ˆæœ¬**: v2.1 (RAG + LLM Enhanced)
**æ›´æ–°æ—¶é—´**: 2026-01-08
