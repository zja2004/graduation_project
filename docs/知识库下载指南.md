# ğŸ“š çŸ¥è¯†åº“ä¸‹è½½ä¸æ„å»ºæŒ‡å—

## ğŸ¯ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ 1: è‡ªåŠ¨ä¸‹è½½ï¼ˆæ¨èï¼‰

```powershell
# 1. ä¸‹è½½çŸ¥è¯†åº“æ•°æ®
.\ä¸‹è½½çŸ¥è¯†åº“.bat

# 2. æ„å»ºç´¢å¼•
.\æ„å»ºçŸ¥è¯†åº“ç´¢å¼•.bat

# 3. æµ‹è¯•
python main.py --vcf examples\test_with_genes.vcf --output runs\test
```

### æ–¹å¼ 2: å‘½ä»¤è¡Œ

```powershell
# æµ‹è¯•æ¨¡å¼ï¼ˆæ¨èï¼‰
python tools/download_knowledge_bases.py

# ç”Ÿäº§æ¨¡å¼ï¼ˆå®Œæ•´æ•°æ®ï¼‰
python tools/download_knowledge_bases.py --production

# æ„å»ºç´¢å¼•ï¼ˆä»… chr22ï¼‰
python tools/build_knowledge_index_enhanced.py --chromosomes 22

# æ„å»ºç´¢å¼•ï¼ˆæ‰€æœ‰æŸ“è‰²ä½“ï¼‰
python tools/build_knowledge_index_enhanced.py
```

---

## ğŸ“Š æ•°æ®æºè¯¦æƒ…

### 1. ClinVar (å¿…éœ€)

**æè¿°**: ä¸´åºŠæ„ä¹‰å·²éªŒè¯çš„åŸºå› å˜å¼‚æ•°æ®åº“
**å¤§å°**: ~2 GB (å‹ç¼©)
**æ¥æº**: NCBI
**è‡ªåŠ¨ä¸‹è½½**: âœ… æ˜¯

**ä¸‹è½½é“¾æ¥**:
```
https://ftp.ncbi.nlm.nih.gov/pub/clinvar/vcf_GRCh38/clinvar.vcf.gz
```

**æ‰‹åŠ¨ä¸‹è½½**ï¼ˆå¯é€‰ï¼‰:
```powershell
# Windows
curl -o data\knowledge\raw\clinvar.vcf.gz https://ftp.ncbi.nlm.nih.gov/pub/clinvar/vcf_GRCh38/clinvar.vcf.gz

# æˆ–ä½¿ç”¨æµè§ˆå™¨ä¸‹è½½
start https://ftp.ncbi.nlm.nih.gov/pub/clinvar/vcf_GRCh38/
```

**å†…å®¹**:
- å˜å¼‚ä¸´åºŠæ„ä¹‰åˆ†ç±»ï¼ˆPathogenic/Benign/VUSï¼‰
- å…³è”ç–¾ç—…åç§°
- è¯æ®å®¡æ ¸çŠ¶æ€
- çº¦ 200 ä¸‡æ¡ç»ä¸´åºŠéªŒè¯çš„å˜å¼‚

---

### 2. gnomAD (æ¨è)

**æè¿°**: å…¨çƒäººç¾¤ç­‰ä½åŸºå› é¢‘ç‡æ•°æ®åº“
**å¤§å°**:
- chr22: ~1.2 GBï¼ˆæµ‹è¯•æ¨èï¼‰
- å…¨åŸºå› ç»„: ~89 GBï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
**æ¥æº**: Broad Institute
**è‡ªåŠ¨ä¸‹è½½**: âœ… æ˜¯ï¼ˆchr22ï¼‰

**ä¸‹è½½é“¾æ¥**:
```
# å•æŸ“è‰²ä½“ï¼ˆæ¨èç”¨äºæµ‹è¯•ï¼‰
https://gnomad-public-us-east-1.s3.amazonaws.com/release/3.1.2/vcf/genomes/gnomad.genomes.v3.1.2.sites.chr22.vcf.bgz

# å…¨åŸºå› ç»„ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
https://gnomad-public-us-east-1.s3.amazonaws.com/release/3.1.2/vcf/genomes/gnomad.genomes.v3.1.2.sites.vcf.bgz
```

**æ‰‹åŠ¨ä¸‹è½½ç‰¹å®šæŸ“è‰²ä½“**:
```powershell
# ä¸‹è½½å¸¸ç”¨æŸ“è‰²ä½“ï¼ˆ1, 7, 17, 22ï¼‰
$chromosomes = @(1, 7, 17, 22)
foreach ($chr in $chromosomes) {
    $url = "https://gnomad-public-us-east-1.s3.amazonaws.com/release/3.1.2/vcf/genomes/gnomad.genomes.v3.1.2.sites.chr$chr.vcf.bgz"
    curl -o "data\knowledge\raw\gnomad.chr$chr.vcf.bgz" $url
}
```

**å†…å®¹**:
- å…¨çƒ 76,156 ä¸ªä¸ªä½“çš„åŸºå› ç»„æ•°æ®
- ç­‰ä½åŸºå› é¢‘ç‡ (AF)
- çº¯åˆå­/æ‚åˆå­è®¡æ•°
- ç”¨äºåˆ¤æ–­å˜å¼‚ç¨€æœ‰ç¨‹åº¦

---

### 3. NCBI Gene Info (æ¨è)

**æè¿°**: äººç±»åŸºå› åŠŸèƒ½æ³¨é‡Šä¿¡æ¯
**å¤§å°**: ~50 MB (å‹ç¼©)
**æ¥æº**: NCBI
**è‡ªåŠ¨ä¸‹è½½**: âœ… æ˜¯

**ä¸‹è½½é“¾æ¥**:
```
https://ftp.ncbi.nlm.nih.gov/gene/DATA/GENE_INFO/Mammalia/Homo_sapiens.gene_info.gz
```

**å†…å®¹**:
- åŸºå› ç¬¦å·å’Œåˆ«å
- åŠŸèƒ½æè¿°
- æŸ“è‰²ä½“å®šä½
- åŸºå› ç±»å‹
- çº¦ 60,000 ä¸ªåŸºå› è®°å½•

---

### 4. PharmGKB (å¯é€‰)

**æè¿°**: è¯ç‰©åŸºå› ç»„å­¦çŸ¥è¯†åº“
**å¤§å°**: ~15 MB
**æ¥æº**: PharmGKB
**è‡ªåŠ¨ä¸‹è½½**: âœ… æ˜¯

**ä¸‹è½½é“¾æ¥**:
```
https://api.pharmgkb.org/v1/download/file/data/genes.zip
https://api.pharmgkb.org/v1/download/file/data/clinicalVariants.zip
```

**å†…å®¹**:
- VIP åŸºå› ï¼ˆVery Important Pharmacogenesï¼‰
- è¯ç‰©-åŸºå› ç›¸äº’ä½œç”¨
- ä¸´åºŠå˜å¼‚æ³¨é‡Š
- ç”¨è¯æŒ‡å¯¼ä¿¡æ¯

---

### 5. OMIM (éœ€è¦æˆæƒ)

**æè¿°**: äººç±»åŸºå› å’Œé—ä¼ æ€§ç–¾ç—…çŸ¥è¯†åº“
**å¤§å°**: ~100 MB
**æ¥æº**: Johns Hopkins University
**è‡ªåŠ¨ä¸‹è½½**: âŒ éœ€è¦æ‰‹åŠ¨ç”³è¯·

**ç”³è¯·æµç¨‹**:
1. è®¿é—® https://www.omim.org/
2. æ³¨å†Œè´¦å·
3. ç”³è¯·å­¦æœ¯è®¿é—®æƒé™
4. ä¸‹è½½ `omim.txt` æˆ– `mim2gene.txt`
5. ä¿å­˜åˆ° `data/knowledge/raw/omim.txt`

**å†…å®¹**:
- åŸºå› -ç–¾ç—…å…³è”
- é—ä¼ æ¨¡å¼ï¼ˆå¸¸æŸ“è‰²ä½“æ˜¾æ€§/éšæ€§ç­‰ï¼‰
- ä¸´åºŠç‰¹å¾æè¿°
- çº¦ 25,000 æ¡è®°å½•

---

### 6. COSMIC (éœ€è¦æˆæƒ)

**æè¿°**: ç™Œç—‡ä½“ç»†èƒçªå˜æ•°æ®åº“
**å¤§å°**: ~500 MB
**æ¥æº**: Wellcome Sanger Institute
**è‡ªåŠ¨ä¸‹è½½**: âŒ éœ€è¦æ³¨å†Œ

**ç”³è¯·æµç¨‹**:
1. è®¿é—® https://cancer.sanger.ac.uk/cosmic
2. æ³¨å†Œå…è´¹å­¦æœ¯è´¦å·
3. ä¸‹è½½ `CosmicCodingMuts.vcf.gz`
4. ä¿å­˜åˆ° `data/knowledge/raw/cosmic.vcf.gz`

**å†…å®¹**:
- ç™Œç—‡ä½“ç»†èƒçªå˜
- è‚¿ç˜¤ç±»å‹å…³è”
- çªå˜é¢‘ç‡ç»Ÿè®¡
- çº¦ 900 ä¸‡æ¡ä½“ç»†èƒçªå˜

---

## ğŸš€ å®Œæ•´æ„å»ºæµç¨‹

### æ­¥éª¤ 1: ä¸‹è½½æ•°æ®

```powershell
# æ–¹å¼ 1: ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬ï¼ˆæ¨èï¼‰
.\ä¸‹è½½çŸ¥è¯†åº“.bat

# æ–¹å¼ 2: ä½¿ç”¨ Python è„šæœ¬
python tools/download_knowledge_bases.py

# æ–¹å¼ 3: æ‰‹åŠ¨ä¸‹è½½
# è®¿é—®ä¸Šè¿°é“¾æ¥ï¼Œä¸‹è½½æ–‡ä»¶åˆ° data/knowledge/raw/ ç›®å½•
```

**ä¸‹è½½å®Œæˆåï¼Œç›®å½•ç»“æ„**:
```
data/knowledge/raw/
â”œâ”€â”€ clinvar.vcf.gz              (2 GB)
â”œâ”€â”€ clinvar.vcf.gz.tbi          (2 MB)
â”œâ”€â”€ gnomad.chr22.vcf.bgz        (1.2 GB)
â”œâ”€â”€ Homo_sapiens.gene_info.gz   (50 MB)
â”œâ”€â”€ pharmgkb_genes.zip          (10 MB)
â””â”€â”€ pharmgkb_variants.zip       (5 MB)
```

---

### æ­¥éª¤ 2: æ„å»ºç´¢å¼•

```powershell
# æ–¹å¼ 1: ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬ï¼ˆæ¨èï¼‰
.\æ„å»ºçŸ¥è¯†åº“ç´¢å¼•.bat

# æ–¹å¼ 2: ä½¿ç”¨ Python è„šæœ¬
python tools/build_knowledge_index_enhanced.py --chromosomes 22

# æ–¹å¼ 3: è‡ªå®šä¹‰æ„å»º
python tools/build_knowledge_index_enhanced.py \
    --clinvar data/knowledge/raw/clinvar.vcf.gz \
    --gnomad data/knowledge/raw/gnomad.chr22.vcf.bgz \
    --gene-info data/knowledge/raw/Homo_sapiens.gene_info.gz \
    --pharmgkb data/knowledge/raw/pharmgkb_genes.zip \
    --chromosomes 22
```

**æ„å»ºå®Œæˆå**:
```
data/knowledge/
â”œâ”€â”€ knowledge.db        (çº¦ 50-500 MBï¼Œå–å†³äºæŸ“è‰²ä½“æ•°é‡)
â””â”€â”€ raw/                (åŸå§‹ä¸‹è½½æ–‡ä»¶)
```

---

### æ­¥éª¤ 3: éªŒè¯

```powershell
# æŸ¥çœ‹æ•°æ®åº“ç»Ÿè®¡
python -c "import sqlite3; conn=sqlite3.connect('data/knowledge/knowledge.db'); c=conn.cursor(); tables=['clinvar','gnomad','gene_info','pharmgkb_genes']; [c.execute(f'SELECT COUNT(*) FROM {t}') or print(f'{t}: {c.fetchone()[0]:,}') for t in tables]"

# é¢„æœŸè¾“å‡ºï¼ˆchr22 ç¤ºä¾‹ï¼‰:
# clinvar: 45,000
# gnomad: 1,200,000
# gene_info: 60,000
# pharmgkb_genes: 700
```

---

## ğŸ“ˆ ç£ç›˜ç©ºé—´éœ€æ±‚

### æµ‹è¯•æ¨¡å¼ï¼ˆæ¨èï¼‰
- **ä¸‹è½½**: ~3.3 GB
- **ç´¢å¼•**: ~50 MB
- **æ€»è®¡**: ~3.4 GB

### ç”Ÿäº§æ¨¡å¼ï¼ˆå®Œæ•´æ•°æ®ï¼‰
- **ä¸‹è½½**: ~92 GB
- **ç´¢å¼•**: ~5 GB
- **æ€»è®¡**: ~97 GB

---

## âš™ï¸ é«˜çº§é…ç½®

### ä»…æ„å»ºç‰¹å®šæŸ“è‰²ä½“

é€‚ç”¨äºç‰¹å®šç ”ç©¶ï¼ˆå¦‚ç™Œç—‡ç›¸å…³æŸ“è‰²ä½“ï¼‰:

```powershell
# å¸¸è§ç™Œç—‡åŸºå› ç›¸å…³æŸ“è‰²ä½“: 7 (BRAF), 17 (TP53, BRCA1), 13 (BRCA2)
python tools/build_knowledge_index_enhanced.py --chromosomes 7 13 17 22
```

### å¢é‡æ›´æ–°

ClinVar æ¯æœˆæ›´æ–°ï¼Œå¯å®šæœŸé‡æ–°ä¸‹è½½å’Œæ„å»º:

```powershell
# 1. å¤‡ä»½æ—§æ•°æ®åº“
copy data\knowledge\knowledge.db data\knowledge\knowledge.db.bak

# 2. é‡æ–°ä¸‹è½½ ClinVar
python tools/download_knowledge_bases.py

# 3. é‡æ–°æ„å»ºç´¢å¼•
python tools/build_knowledge_index_enhanced.py
```

### æ€§èƒ½ä¼˜åŒ–

å¯¹äºå¤§è§„æ¨¡æ•°æ®ï¼Œå¯ä»¥åˆ†æ‰¹æ„å»º:

```powershell
# æ–¹å¼ 1: é€æŸ“è‰²ä½“æ„å»º
for ($i=1; $i -le 22; $i++) {
    python tools/build_knowledge_index_enhanced.py --chromosomes $i
}

# æ–¹å¼ 2: ä½¿ç”¨ SSD åŠ é€Ÿ
# å°† data/knowledge/ ç§»åŠ¨åˆ° SSD åˆ†åŒº
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ 1: ä¸‹è½½é€Ÿåº¦æ…¢

**è§£å†³æ–¹æ¡ˆ**:
```powershell
# ä½¿ç”¨é•œåƒç«™ï¼ˆå¦‚æœ‰ï¼‰
# æˆ–ä½¿ç”¨ä¸‹è½½å·¥å…·ï¼ˆå¦‚ wget, aria2ï¼‰
aria2c -x 16 -s 16 https://ftp.ncbi.nlm.nih.gov/pub/clinvar/vcf_GRCh38/clinvar.vcf.gz
```

### é—®é¢˜ 2: ç£ç›˜ç©ºé—´ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**:
```powershell
# ä»…ä¸‹è½½å¿…éœ€çš„æ•°æ®æº
python tools/download_knowledge_bases.py

# ä¸‹è½½ååˆ é™¤å‹ç¼©æ–‡ä»¶ï¼ˆæ„å»ºç´¢å¼•åï¼‰
del data\knowledge\raw\*.vcf.gz
del data\knowledge\raw\*.vcf.bgz
```

### é—®é¢˜ 3: æ„å»ºæ—¶å†…å­˜ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**:
```python
# ä¿®æ”¹ build_knowledge_index_enhanced.py ä¸­çš„æ‰¹å¤„ç†å¤§å°
BATCH_SIZE = 500  # ä» 1000 é™ä½åˆ° 500
```

### é—®é¢˜ 4: æ–‡ä»¶æŸå

**è§£å†³æ–¹æ¡ˆ**:
```powershell
# é‡æ–°ä¸‹è½½æŸåçš„æ–‡ä»¶
python tools/download_knowledge_bases.py

# éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
gzip -t data\knowledge\raw\clinvar.vcf.gz
```

---

## ğŸ“Š æ•°æ®åº“æŸ¥è¯¢ç¤ºä¾‹

### æŸ¥è¯¢ ClinVar ä¸­çš„è‡´ç—…å˜å¼‚

```python
import sqlite3

conn = sqlite3.connect('data/knowledge/knowledge.db')
c = conn.cursor()

# æŸ¥è¯¢è‡´ç—…æ€§å˜å¼‚
c.execute("""
    SELECT variant_id, clnsig, clndn
    FROM clinvar
    WHERE clnsig LIKE '%Pathogenic%'
    LIMIT 10
""")

for row in c.fetchall():
    print(f"{row[0]}: {row[1]} - {row[2]}")
```

### æŸ¥è¯¢åŸºå› ä¿¡æ¯

```python
# æŸ¥è¯¢ BRAF åŸºå› 
c.execute("SELECT * FROM gene_info WHERE symbol='BRAF'")
gene = c.fetchone()
print(f"åŸºå› æè¿°: {gene[2]}")
print(f"æŸ“è‰²ä½“ä½ç½®: {gene[3]}")
```

### æŸ¥è¯¢äººç¾¤é¢‘ç‡

```python
# æŸ¥è¯¢ç½•è§å˜å¼‚ (AF < 0.001)
c.execute("""
    SELECT chrom, pos, ref, alt, af
    FROM gnomad
    WHERE af < 0.001 AND chrom='22'
    LIMIT 10
""")

for row in c.fetchall():
    print(f"{row[0]}:{row[1]} {row[2]}>{row[3]} AF={row[4]}")
```

---

## ğŸ‰ å®Œæˆï¼

çŸ¥è¯†åº“æ„å»ºå®Œæˆåï¼Œæ‚¨çš„ç³»ç»Ÿå°†æ‹¥æœ‰ï¼š

âœ… **200 ä¸‡+** ClinVar ä¸´åºŠéªŒè¯å˜å¼‚
âœ… **æ•°ç™¾ä¸‡** gnomAD äººç¾¤é¢‘ç‡æ•°æ®
âœ… **60,000+** åŸºå› åŠŸèƒ½æ³¨é‡Š
âœ… **700+** è¯ç‰©åŸºå› ç»„å­¦åŸºå› 
âœ… **AI é€šä¿—åŒ–è§£é‡Š** åŸºäº DeepSeek LLM

ç°åœ¨å¯ä»¥è¿è¡Œå®Œæ•´çš„åŸºå› ç»„åˆ†æï¼š

```powershell
python main.py --vcf examples\test_with_genes.vcf --output runs\full_test --sample production
```

æŠ¥å‘Šå°†åŒ…å«ï¼š
- å¤šæºè¯æ®æ”¯æŒï¼ˆClinVar + gnomAD + é¢„æµ‹ï¼‰
- äººç¾¤é¢‘ç‡æ¯”å¯¹
- ğŸ¤– AI é€šä¿—åŒ–è§£é‡Š
- ç¾è§‚çš„ HTML æŠ¥å‘Š

---

**æ›´æ–°æ—¶é—´**: 2026-01-15
**ç‰ˆæœ¬**: v3.0 (Multi-source RAG Enhanced)
