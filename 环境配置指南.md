# ç¯å¢ƒé…ç½®æŒ‡å—

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. å¯¼å…¥é”™è¯¯ä¿®å¤
**é—®é¢˜**: `ImportError: cannot import name 'ExecutorScheduler' from 'agents.executor'`

**åŸå› **: Python æ¨¡å—å‘½åå†²çª
- `agents/executor.py` (æ¨¡å—æ–‡ä»¶)
- `agents/executor/` (åŒ…ç›®å½•)

**è§£å†³æ–¹æ¡ˆ**:
- âœ… å·²å°† `agents/executor.py` é‡å‘½åä¸º `agents/scheduler.py`
- âœ… å·²æ›´æ–° `main.py` ä¸­çš„å¯¼å…¥è¯­å¥
- âœ… å·²æ¸…ç†æ‰€æœ‰ Python ç¼“å­˜æ–‡ä»¶

### 2. Python ç¼“å­˜æ¸…ç†
**æ“ä½œ**: åˆ é™¤äº†æ‰€æœ‰ `__pycache__` ç›®å½•å’Œ `.pyc` æ–‡ä»¶

## ğŸš€ è¿è¡Œæµ‹è¯•

### æ–¹å¼ 1: ä½¿ç”¨æµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰

```powershell
.\run_fixed_test.bat
```

è¯¥è„šæœ¬ä¼šè‡ªåŠ¨:
1. æ¸…ç† Python ç¼“å­˜
2. è¿è¡Œå®Œæ•´åˆ†ææµç¨‹
3. æ˜¾ç¤ºç”Ÿæˆçš„æŠ¥å‘Š

### æ–¹å¼ 2: å‘½ä»¤è¡Œè¿è¡Œ

```powershell
# æ¸…ç†ç¼“å­˜ï¼ˆé¦–æ¬¡è¿è¡Œå¿…é¡»æ‰§è¡Œï¼‰
.\clean_cache.bat

# è¿è¡Œåˆ†æ
python main.py --vcf examples\test.vcf --output runs\test --sample demo
```

### æ–¹å¼ 3: åˆ†æ­¥æ‰§è¡Œ

```powershell
# æ­¥éª¤ 1: ä»…ç”Ÿæˆæ‰§è¡Œè®¡åˆ’
python main.py --vcf examples\test.vcf --output runs\demo --plan-only

# æ­¥éª¤ 2: æŸ¥çœ‹è®¡åˆ’
type runs\demo\plan.yaml

# æ­¥éª¤ 3: æ‰§è¡Œè®¡åˆ’
python main.py --execute-plan runs\demo\plan.yaml
```

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

### Python ç‰ˆæœ¬
- Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- ä½¿ç”¨ `python --version` æ£€æŸ¥ç‰ˆæœ¬

### å¿…éœ€çš„ Python åŒ…

å·²åœ¨ `pyproject.toml` ä¸­å®šä¹‰ï¼Œä½¿ç”¨ UV å®‰è£…:

```powershell
# å®‰è£… UVï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰
pip install uv

# ä½¿ç”¨ UV å®‰è£…ä¾èµ–
uv pip install -e .
```

æˆ–ä½¿ç”¨ pip:

```powershell
pip install numpy pandas pyyaml requests pyarrow
```

### å¯é€‰åŒ…ï¼ˆç”¨äºçœŸå®åŸºå› ç»„åˆ†æï¼‰

```powershell
pip install pysam pyfaidx
```

æ³¨æ„: å¦‚æœæœªå®‰è£…è¿™äº›åŒ…ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨æ¨¡æ‹Ÿåºåˆ—æ•°æ®ã€‚

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ 1: ImportError æŒç»­å‡ºç°

**ç—‡çŠ¶**: å³ä½¿ä¿®å¤äº†ä»£ç ï¼Œä»ç„¶å‡ºç°å¯¼å…¥é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```powershell
# æ‰‹åŠ¨åˆ é™¤æ‰€æœ‰ç¼“å­˜
Get-ChildItem -Recurse -Filter "__pycache__" | Remove-Item -Recurse -Force
Get-ChildItem -Recurse -Filter "*.pyc" | Remove-Item -Force

# é‡æ–°è¿è¡Œ
python main.py --vcf examples\test.vcf --output runs\test --sample demo
```

### é—®é¢˜ 2: Genos æœåŠ¡è¿æ¥å¤±è´¥

**ç—‡çŠ¶**:
```
ConnectionError: Failed to connect to Genos server
```

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ Genos æœåŠ¡æ˜¯å¦è¿è¡Œ:
   ```powershell
   # æµ‹è¯•æœåŠ¡è¿æ¥
   curl http://127.0.0.1:8000/health
   ```

2. å¦‚æœæœåŠ¡æœªè¿è¡Œï¼Œå¯åŠ¨ Genos æœåŠ¡:
   ```powershell
   # è¿›å…¥ Genos æœåŠ¡ç›®å½•
   cd ..\genos-server

   # å¯åŠ¨æœåŠ¡
   python genos_server.py --model_path_prefix "E:\path\to\models\BGI-HangzhouAI\"
   ```

3. æ£€æŸ¥é…ç½®æ–‡ä»¶ `configs/run.yaml` ä¸­çš„æœåŠ¡åœ°å€

### é—®é¢˜ 3: æ¨¡å—æœªæ‰¾åˆ°

**ç—‡çŠ¶**:
```
ModuleNotFoundError: No module named 'numpy'
```

**è§£å†³æ–¹æ¡ˆ**:
```powershell
# ä½¿ç”¨ UV å®‰è£…ä¾èµ–
uv pip install -e .

# æˆ–ä½¿ç”¨ pip
pip install numpy pandas pyyaml requests pyarrow
```

### é—®é¢˜ 4: VCF æ–‡ä»¶ç”¨ Outlook æ‰“å¼€

**ç—‡çŠ¶**: åŒå‡» VCF æ–‡ä»¶æ—¶ç”¨ Outlook æ‰“å¼€ï¼ˆè€Œä¸æ˜¯æ–‡æœ¬ç¼–è¾‘å™¨ï¼‰

**è§£å†³æ–¹æ¡ˆ**:
- VCF æœ‰ä¸¤ä¸ªå«ä¹‰: å˜å¼‚è°ƒç”¨æ ¼å¼(Variant Call Format) å’Œ ç”µå­åç‰‡(vCard)
- ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€: å³é”® â†’ æ‰“å¼€æ–¹å¼ â†’ è®°äº‹æœ¬

## ğŸ“Š éªŒè¯å®‰è£…

è¿è¡Œå¿«é€Ÿæµ‹è¯•:

```powershell
# æµ‹è¯• Python å¯¼å…¥
python -c "from agents.scheduler import ExecutorScheduler; print('âœ“ å¯¼å…¥æˆåŠŸ')"

# æµ‹è¯• Genos å®¢æˆ·ç«¯
python -c "from tools.genos_client import create_client; print('âœ“ Genos å®¢æˆ·ç«¯å¯ç”¨')"

# æµ‹è¯•é…ç½®åŠ è½½
python -c "import yaml; print('âœ“ YAML æ”¯æŒå¯ç”¨')"
```

## ğŸ¯ é¢„æœŸè¾“å‡º

è¿è¡ŒæˆåŠŸåï¼Œ`runs/test/` ç›®å½•ä¸‹ä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶:

```
runs/test/
â”œâ”€â”€ plan.yaml                    # âœ… æ‰§è¡Œè®¡åˆ’ (7æ­¥ä»»åŠ¡DAG)
â”œâ”€â”€ variants.filtered.vcf        # âœ… ç­›é€‰åå˜å¼‚
â”œâ”€â”€ contexts.jsonl               # âœ… åºåˆ—ä¸Šä¸‹æ–‡
â”œâ”€â”€ genos_embeddings.parquet     # âœ… Genos embeddings
â”œâ”€â”€ scores.tsv                   # âœ… å˜å¼‚è¯„åˆ†
â”œâ”€â”€ evidence.json                # âœ… è¯æ®æ£€ç´¢ç»“æœ
â”œâ”€â”€ report.md                    # âœ… åˆ†ææŠ¥å‘Šï¼ˆä¸»è¦è¾“å‡ºï¼‰
â”œâ”€â”€ critic_report.json           # âœ… Critic å®¡æ ¡ç»“æœ
â””â”€â”€ pipeline.log                 # âœ… è¿è¡Œæ—¥å¿—
```

æŸ¥çœ‹æŠ¥å‘Š:

```powershell
# åœ¨è®°äº‹æœ¬ä¸­æŸ¥çœ‹
notepad runs\test\report.md

# åœ¨å‘½ä»¤è¡Œä¸­æŸ¥çœ‹
type runs\test\report.md
```

## ğŸ“ å…³é”®æ–‡ä»¶è¯´æ˜

### å·²ä¿®å¤çš„æ–‡ä»¶

1. **agents/scheduler.py** (åŸ executor.py)
   - åŒ…å« `ExecutorScheduler` ç±»
   - è´Ÿè´£ä»»åŠ¡è°ƒåº¦å’Œæ‰§è¡Œ

2. **main.py**
   - æ›´æ–°å¯¼å…¥: `from agents.scheduler import ExecutorScheduler`
   - å‘½ä»¤è¡Œå…¥å£

3. **tools/fasta_utils.py**
   - æ·»åŠ äº† `extract_sequence_window()` å‡½æ•°
   - æ”¯æŒæ¨¡æ‹Ÿåºåˆ—ç”Ÿæˆ

### é…ç½®æ–‡ä»¶

- **configs/run.yaml**: æ‰€æœ‰ç³»ç»Ÿå‚æ•°çš„ä¸­å¿ƒé…ç½®
- **pyproject.toml**: é¡¹ç›®ä¾èµ–å®šä¹‰

## âœ¨ ä¸‹ä¸€æ­¥

ç¯å¢ƒå·²é…ç½®å®Œæˆï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨:

```powershell
# ç«‹å³è¿è¡Œæµ‹è¯•
.\run_fixed_test.bat
```

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹:
- æ‰§è¡Œæ—¥å¿—: `runs/test/pipeline.log`
- é”™è¯¯è¾“å‡º: å‘½ä»¤è¡Œçª—å£ä¸­çš„çº¢è‰²æ–‡æœ¬

---

**ç¯å¢ƒé…ç½®å®Œæˆæ—¶é—´**: 2026-01-08
**çŠ¶æ€**: âœ… å°±ç»ª
